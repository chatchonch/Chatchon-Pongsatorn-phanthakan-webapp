<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="styles/selectPlace.css" />
    <script src="scripts/selectPlace.js"></script>
  </head>

  <body>
    <ul>
      <li class="left-content">ระบบนัด PCU</li>
      <a href="login.html"><li class="right-content">ล็อกเอ้าท์</li></a>
      <a href="admin.html"><li class="right-content">หน้าแรก</li></a>
    </ul>
    <img src="images/8507.jpg" class="mainPic" />
    <div class="topic">
      <p class="placeForService" style="color: black;" >สถานบริการที่ 1</p>
    </div>
    <p>
      ——————————————————————————————————————————————————————————————————————————————————
    </p>
    <div class="main-content">
      <div class="templateFunc">
        <div class="insideTemplateFunc"><p class="stylePlace">แก้ไขเวลา </p></div>
        <div>
          <img src="images/picture (1).svg" class="setPlacePic2" />
          <div class="flexDirectColumn"><button class="checkBut" id="timerChanger">กำหนดเวลาเปิด-ปิด</button></div>
        </div>
      </div>
      <div class="templateFunc">
        <div class="insideTemplateFunc"><p class="stylePlace">ตรวจสอบนัดผู้ป่วย </p></div>
        <div>
          <img src="images/checklist.svg" class="setPlacePic" />
          <div class="flexDirectColumn"><button class="checkBut" id="clientButton" >ตรวจสอบ</button>
            </div>
        </div>
      </div>
    </div>
    <div class="bg-timeModal">
      <div class="container-contents">
        <div class="container">
          <div class="headBox">
              <p>สถานบริการที่ 1</p>
          </div>
          <div class="close-timerChange">+</div>

          <label id="dateLabel">วันเปิดทำการ:</label>
          <div class="date">
              <label>Date</label> 
              <input type="date" id="dateOpen">
          </div>
          
          <label id="timeLabel">กำหนดเวลาเปิด-ปิด:</label>
          <div class="timer">
              <label>Time</label>
              <input type="time" id="openTime">
              <label>ถึง</label>
              <label>Time</label>
              <input type="time" id="closeTime">
      
          </div>

          <div class="staff">
              <label id="staffLabel">จำนวนแพทย์ประจำวัน:</label>
              <input type="number" class="countStaff" id="doctor">
              <label>คน</label>
      
          </div>

          <div class="button">
              <button id="cancletime-button">ยกเลิก</button>
              <button id="fixtime-button">ตกลง</button>
          </div>
                                            
        </div>
      </div>
    </div>
    <div class="bg-clientModal">
      <div class="client-contents">
        <div class="client">
          <div class="headBox">
              <p>ตรวจสอบนัดผู้ป่วย</p>
          </div>
          <div class="close-client">+</div>

          <label class="clientLabel">รหัสบัตรประชาชน:</label>
          <input type="text" class="client-id" id="SSN">
          
          <div class="button">
            <button id="submit-button" onclick="alert('ตรวจสอบเสร็จสิ้น')">ตกลง</button>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-firestore.js"></script>
  <script>
    let date = document.getElementById("dateOpen");
    let openTime = document.getElementById("openTime");
    let closeTime = document.getElementById("closeTime");
    let doctor = document.getElementById("doctor");
    let submitBtn = document.getElementById("fixtime-button");
    let clearBtn = document.getElementById("cancletime-button");
    let changeTimeBtn = document.getElementById("timerChanger");
    let searchBtn = document.getElementById("submit-button");
    let SSN = document.getElementById("SSN");

    var firebaseConfig = {
      apiKey: "AIzaSyBsm2OONg2-y0A53i0mhDrGaBv_EzNksRE",
      authDomain: "myprojectpcu.firebaseapp.com",
      projectId: "myprojectpcu",
      storageBucket: "myprojectpcu.appspot.com",
      messagingSenderId: "653860991694",
      appId: "1:653860991694:web:09b7de81d7b5f15d2b569f",
      measurementId: "G-CB5P88YJ8G"
    };

    firebase.initializeApp(firebaseConfig);
    
    var db = firebase.firestore();
    var docRef = db.collection("สถานบริการที่ 1").doc("Time");

    changeTimeBtn.addEventListener('click', function() {
      docRef.get().then(function(doc) {
        if (doc.exists) {
            console.log("Document data:", doc.data());
            date.value = doc.data().date;
            openTime.value = doc.data().openTime;
            closeTime.value = doc.data().closeTime;
            doctor.value = doc.data().doctor
        } else {
          // doc.data() will be undefined in this case
          console.log("No such document!");
        }
    }).catch(function(error) {
        console.log("Error getting document:", error);
});
    })

    submitBtn.addEventListener('click', function() {
      setData();
      addDataToFireBase();
})

    clearBtn.addEventListener('click', function() {
      date.value = '';
      openTime.value = '';
      closeTime.value = '';
      doctor.value = '';
      setData();
      addDataToFireBase();
    })

    searchBtn.addEventListener('click', function() {
      SSN = SSN.value;
      db.collection("สถานบริการที่ 1").doc(SSN).get().then(function(doc) {
        if (doc.exists) {
          console.log("Document data:", doc.data());
        }
        else {
          // doc.data() will be undefined in this case
          console.log("No such document!");
        }
      }).catch(function(error) {
        console.log("Error getting document:", error);
});
    })

function addDataToFireBase() {
  db.collection("สถานบริการที่ 1").doc("Time").set({
        date: date,
        openTime: openTime,
        closeTime: closeTime,
        doctor: doctor,
      })
      .then(function(docRef) {
      console.log("Document written with ID: ", docRef.id);
      })
      .catch(function(error) {
        console.error("Error adding document: ", error);
      })
}

function setData() {
  date = date.value;
  openTime = openTime.value;
  closeTime = closeTime.value;
  doctor = doctor.value;
}
</script>
</html>